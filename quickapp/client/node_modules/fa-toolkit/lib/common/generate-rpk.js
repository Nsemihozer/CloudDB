"use strict";var _0xbd42e1=_0x228f;function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(_0x228f(403))}function _0x228f(e,r){var t=_0x1775();return(_0x228f=function(e,r){return t[e-=310]})(e,r)}function _iterableToArray(e){var r=_0x228f;if(typeof Symbol!==r(310)&&null!=e[Symbol.iterator]||null!=e[r(322)])return Array[r(356)](e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,r){var t,n=_0x228f,i=typeof Symbol!==n(310)&&e[Symbol[n(325)]]||e[n(322)];if(!i){if(Array[n(314)](e)||(i=_unsupportedIterableToArray(e))||r&&e&&typeof e[n(404)]===n(402))return i&&(e=i),t=0,{s:r=function(){},n:function(){return t>=e[n(404)]?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r};throw new TypeError(n(330))}var a,o=!0,s=!1;return{s:function(){i=i[n(343)](e)},n:function(){var e=i[n(408)]();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){var e=n;try{o||null==i.return||i[e(350)]()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,r){var t=_0x228f;if(e){if(typeof e===t(328))return _arrayLikeToArray(e,r);var n=Object.prototype[t(333)][t(343)](e).slice(8,-1);return(n=n===t(390)&&e[t(360)]?e[t(360)][t(381)]:n)===t(396)||"Set"===n?Array.from(e):n===t(323)||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/[t(311)](n)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){var t=_0x228f;(null==r||r>e[t(404)])&&(r=e[t(404)]);for(var n=0,i=new Array(r);n<r;n++)i[n]=e[n];return i}!function(){for(var e=_0x228f,r=_0x1775();;)try{if(934914==+parseInt(e(399))+-parseInt(e(411))/2+parseInt(e(370))/3*(parseInt(e(376))/4)+parseInt(e(312))/5*(parseInt(e(359))/6)+parseInt(e(385))/7+-parseInt(e(345))/8*(parseInt(e(329))/9)+parseInt(e(397))/10*(-parseInt(e(373))/11))break;r.push(r.shift())}catch(e){r.push(r.shift())}}();var projectSingConfig,_fs=require("fs"),_path=require(_0xbd42e1(331)),signUtils=require(_0xbd42e1(348)),utils=require("./utils"),_require=require("../fa-compiler/utils"),isEmptyObject=_require.isEmptyObject,MAX_LEN=60,checkSignObject=[_0xbd42e1(365),_0xbd42e1(417),_0xbd42e1(340),"encryptPassword"],SIGN_CONFIG=utils[_0xbd42e1(393)],WEB_SIGN_CONFIG=utils.WEB_SIGN_CONFIG;function getSignature(e,r){var t=_0xbd42e1;if(!checkSignConfig(r)){var n=e[t(353)],i=e[t(372)],e=e.signRoot,a=getDefDebugKey(),o=a[t(336)],a=a[t(387)],s=n?["release",""]:["release","",t(380)],u=resolveCertificatePath(e,t(391),s),e=resolveCertificatePath(e,t(406),s),s=projectSingConfig?projectSingConfig[t(365)]:i||readSignatureFile(u,!n&&a),i=readSignatureFile(e,!n&&o);if(!checkCertTerm(i,r))return signUtils[t(326)](i,s,projectSingConfig)}}function getDefDebugKey(){var e,r=_0xbd42e1,t=process[r(389)].QUICK_APP&&_path[r(400)](process[r(389)].QUICK_APP,"debugkey"),n={};return t&&(e=_path[r(400)](t,r(341)),t=_path.join(t,r(361)),_fs.existsSync(e)&&(n[r(336)]=_fs[r(355)](e)),_fs[r(364)](t)&&(n[r(387)]=_fs[r(355)](t))),n}function readSignatureFile(e,r){var t=_0xbd42e1;if(e){e=_fs[t(355)](e);if(e&&e.toString())return e;throw new Error(t(413))}if(projectSingConfig)throw new Error("No certificate signature.");if(r&&r[t(333)]())return r;throw new Error(t(388))}function resolveCertificatePath(e,r,t){var n,i=_0xbd42e1,a="",o=_createForOfIteratorHelper(t);try{for(o.s();!(n=o.n())[i(342)];){var s=n[i(324)],u=_path[i(400)](e,s,""[i(366)](r,i(321)));if(_fs.existsSync(u)){a=u;break}}}catch(e){o.e(e)}finally{o.f()}return a}function generateRpk(e,r,t){var n=_0xbd42e1,i=r[n(381)],r=r[n(410)],a=i,i=(a=i[n(404)]>MAX_LEN?a[n(337)](0,MAX_LEN):a)[n(414)](".")?"":".",a=""[n(366)](a)[n(366)](i)[n(366)](t),i=_path.join(r,a);_fs[n(319)](i,e)}function packingCode(e,r,t,n){var i=_0xbd42e1;_fs.existsSync(e[i(410)])||_fs.mkdirSync(e[i(410)]),_isQuickCardMode||_isFlexibleCardMode?e[i(353)]&&generateRpk(t.rpkBuffer,e,i(401)):(r.length&&_versionType===i(416)&&generateRpk(t.rpksBuffer,e,i(316)),generateRpk(t.rpkBuffer,e,i(394))),n()}function signRpk(e,r,t){var n=_0xbd42e1,i=r[n(381)],a=r[n(382)],o=r[n(368)],s=r[n(378)],u=r[n(354)];if((projectSingConfig=u?WEB_SIGN_CONFIG:SIGN_CONFIG)&&!projectSingConfig[n(409)])throw n(346);var c,f,l,p,g,u=getSignature(r,e);return u?(e=[],l=[],p=[],c=(f=signUtils[n(415)](o))[n(357)],f=f[n(375)],_isQuickCardMode&&(_isFlexibleCardMode&&(l=getFlexibleSignFiles(s),e=getCardScreenshots(s),p=getFlexibleCommonFiles(s),g=getCardIds(),g=findNewObj(utils[n(362)](),g),_fs[n(319)]("".concat(a,n(392)),JSON[n(339)](g,null,2)),signUtils[n(379)](["package.config.json"],a,c,f)),a=s),(l=0<l[n(404)]?l:signUtils.getResources(a)).length?(signUtils[n(379)](l,a,c,f),0<e.length&&signUtils[n(379)](e,_path[n(400)](a,".."),c,f),0<p[n(404)]&&signUtils[n(379)](p,a,c,f),void signUtils.signPkgs(i,u,c,f)[n(395)](function(e){packingCode(r,o,e,t)})):t()):t()}function findNewObj(i,a){var o=_0xbd42e1,s={},u=[o(412),o(358)];return Object[o(363)](i).forEach(function(e){var r,t=o,n=i[e];u[t(315)](e)?0<(r=a[t(344)](function(r){return~n.findIndex(function(e){return e===r})}))[t(404)]&&(s[e]=r):s[e]=n}),s}function checkSignConfig(t){var n=_0xbd42e1,i=!1;return projectSingConfig&&checkSignObject[n(317)](function(e){var r=n;Object[r(313)][r(318)][r(343)](projectSingConfig,e)||(t[r(334)][r(320)]({message:r(386).concat(e)}),i=!0)}),i}function checkCertTerm(e,r){var t=_0xbd42e1,e=signUtils[t(405)](e),n=e.validityDays,e=e[t(338)];return n<0||e?r[t(334)][t(320)]({message:t(351)}):n<180&&r[t(371)][t(320)]({message:t(367)}),0<r.errors[t(404)]}function getFlexibleSignFiles(i){var a=_0xbd42e1,e=[],r=getCardIds();return e=0<(r=getComponentCard(i,r))[a(404)]?r[a(335)](function(e,t){var n=a,r=_path[n(400)](i,t),r=signUtils[n(374)](r);return 0<r[n(404)]&&(r=r.map(function(e){var r=n;return""[r(366)](t,"/")[r(366)](e)}),e=e[n(366)](r)),e},[]):e}function _0x1775(){var e=["constructor","private.pem","getFlexibleCfg","keys","existsSync","keyId","concat","WARNING: Your certificate is valid for less than 180 days. Please update it in time.","subpackages","common/","29541svOEpY","warnings","privateKeyStr","11tNpGyD","getResources","subPkgs","316AlInYP","exports","sourceRoot","addResourceToPkg","debug","name","buildPath","filePath","getFlexibleCards","1946420BQvRlx","ERROR: The signature configuration is incorrect: ","PRIVATE_KEY","No certificate signature.","env","Object","private","/package.config.json","SIGN_CONFIG","rpk","then","Map","12295690zsYBjF",".png","926288eCRssy","join","card","number","Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.","length","checkValidity","certificate",".quickapp","next","host","output","551774BtKyqf","quickCard","Invalid certificate signature.","endsWith","generatePkgDef","release","userName","undefined","test","3405RxFrKO","prototype","isArray","includes","rpks","map","hasOwnProperty","writeFileSync","push",".pem","@@iterator","Arguments","value","iterator","getSignInfo",".quickapp/","string","11824677mzGStu","Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.","path","cardIds","toString","errors","reduce","CERTIFICATE","slice","isInvalid","stringify","passwordDigest","certificate.pem","done","call","filter","8jtzPEj","ERROR: The signature configuration file is incorrect, the hostvalue is empty.","common","../../sign-tools/rpk-sign-utils","dirname","return","ERROR: Your certificate is Invalid.","relative","IS_PRD","isWeb","readFileSync","from","mainPkg","comboCard","15612POidMi"];return(_0x1775=function(){return e})()}function getComponentCard(t,e){var n=_0xbd42e1;return isEmptyObject(_dependComponents)?e:Object[n(363)](_dependComponents).map(function(e){var r=n;return _path[r(349)](_path[r(352)](t,_dependComponents[e][r(383)]))})[n(335)](function(e,r){return e[n(315)](r)||e.push(r),e},e)}function getCardIds(){var e=_0xbd42e1;return process[e(389)][e(332)]?process[e(389)].cardIds.trim().split(","):utils[e(384)]()}function getCardScreenshots(e){var i=_0xbd42e1,a=_path[i(400)](e,"..",i(407));if(!_fs[i(364)](a))return[];var e=[],r=getCardIds();return e=0<r[i(404)]?r[i(335)](function(e,r){var t=i,n=_path[t(400)](a,""[t(366)](r,t(398)));return _fs[t(364)](n)&&e[t(320)](t(327)[t(366)](r,t(398))),e},[]):e}function getFlexibleCommonFiles(e){var r=_0xbd42e1,e=_path.join(e,r(347));if(!_fs[r(364)](e))return[];var t=[],e=signUtils[r(374)](e);return 0<e.length&&(e=e[r(317)](function(e){return r(369).concat(e)}),t=[][r(366)](_toConsumableArray(t),_toConsumableArray(e))),t}module[_0xbd42e1(377)]={signRpk:signRpk};