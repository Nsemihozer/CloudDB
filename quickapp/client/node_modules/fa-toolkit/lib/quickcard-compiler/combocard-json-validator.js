"use strict";var _0x1f4acb=_0x252e;function _createForOfIteratorHelper(r,a){var e,t=_0x252e,n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array[t(310)](r)||(n=_unsupportedIterableToArray(r))||a&&r&&typeof r[t(359)]===t(362))return n&&(r=n),e=0,{s:a=function(){},n:function(){return e>=r[t(359)]?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:a};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n[t(377)](r)},n:function(){var r=t,a=n[r(375)]();return o=a[r(392)],a},e:function(r){c=!0,i=r},f:function(){var r=t;try{o||null==n.return||n[r(397)]()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(r,a){var e=_0x252e;if(r){if(typeof r===e(401))return _arrayLikeToArray(r,a);var t=Object[e(292)].toString[e(377)](r).slice(8,-1);return(t=t===e(368)&&r.constructor?r[e(294)][e(405)]:t)===e(302)||"Set"===t?Array.from(r):t===e(346)||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){var e=_0x252e;(null==a||a>r.length)&&(a=r[e(359)]);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}!function(){for(var r=_0x252e,a=_0xeb6d();;)try{if(549419==+parseInt(r(305))+parseInt(r(336))/2+-parseInt(r(403))/3*(parseInt(r(380))/4)+-parseInt(r(281))/5*(-parseInt(r(317))/6)+-parseInt(r(404))/7+-parseInt(r(369))/8*(-parseInt(r(400))/9)+parseInt(r(353))/10)break;a.push(a.shift())}catch(r){a.push(a.shift())}}();var errLog,validDeclare,currManifestPath,fs=require("fs"),path=require(_0x1f4acb(349)),url=require(_0x1f4acb(316)),utils=require(_0x1f4acb(344)),REGEXP_INT=/^[-+]?[0-9]+$/,REGEXP_ID=/^[a-zA-Z][a-zA-Z0-9_]*(\.[a-zA-Z0-9_]+)+$/,MAX_LENGTH_ID=64,projectPath=utils[_0x1f4acb(301)],getJsonData=utils[_0x1f4acb(307)],srcPath=path[_0x1f4acb(376)](projectPath,_0x1f4acb(355)),buildPath=path[_0x1f4acb(376)](projectPath,"build"),ARRAY_MAX_LENGTH=2048,requireAttrMap=[];function makeEnumValidator(r,a){var e=_0x1f4acb;return validator[e(399)][e(356)](null,r,a)}function bindArgs(r){for(var a=_0x1f4acb,e=arguments[a(359)],t=new Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return r.bind[a(323)](r,[null][a(406)](t))}var validator={enum:function(t){var r,n=_0x1f4acb,i=1<arguments[n(359)]&&void 0!==arguments[1]?arguments[1]:"ERROR",a=2<arguments.length?arguments[2]:void 0,a=Array.isArray(a)?a:[a],e=t[n(322)](function(r,a){return r[a]=a,r},{}),o=_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n())[n(392)];)if(!e[r[n(339)]])return{value:!1,reason:function(r,a){var e=n;return"".concat(i,": Attribute '")[e(406)](r,e(299))[e(406)](a,"' is invalid,\n   ")+e(329).concat(t.join(e(312)),e(348))}}}catch(r){o.e(r)}finally{o.f()}return{value:a}},string:function(r){var t=_0x1f4acb;return Object[t(292)][t(370)][t(377)](r)!==t(407)?{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,e(299)).concat(a,e(288))+e(347)}}:{value:!0}},integer:function(r){var t=_0x1f4acb;return t(401)===typeof r?r[t(313)](REGEXP_INT)?{value:!0,reason:function(r,a){var e=t;return"WARNING: manifest.json configuration item '".concat(r,"' ")+e(324).concat(a,"' is a character string, which should be an integer instead.")}}:{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,e(299))[e(406)](a,e(288))+e(379)}}:(r=(r||"").toString()).match(REGEXP_INT)?{value:!0}:{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,e(299))[e(406)](a,"' is invalid ")+e(379)}}},array:function(r){return Array.isArray(r)?{value:r}:{value:!1,reason:function(r,a){var e=_0x252e;return e(390)[e(406)](r,e(299))[e(406)](a,e(297))}}},bool:function(r){var t=_0x1f4acb;return Object.prototype[t(370)][t(377)](r)!==t(291)?{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,e(299))[e(406)](a,e(288))+e(345)}}:{value:!0}},id:function(r){var t=_0x1f4acb;return r[t(359)]>MAX_LENGTH_ID?{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,e(342))}}:typeof r===t(401)&&r.match(REGEXP_ID)?{value:!0}:{value:!1,reason:function(r,a){var e=t;return e(384).concat(r,e(299)).concat(a,e(330))}}},minSdkVer:function(t){var n=_0x1f4acb;return JSON[n(367)](fs.readFileSync(currManifestPath,n(333)))[n(371)]<t?{value:!1,reason:function(r,a){var e=n;return"ERROR: '"[e(406)](r,"' has configured for the project, ")+e(320)[e(406)](t,e(295))}}:{value:!0}},type:function(r){var a=_0x1f4acb;return utils[a(290)](r)?{value:!0}:{value:!1,reason:function(){return"ERROR: In combo card manifest.json, the 'type'"+a(358)}}},data:function(t){var n=_0x1f4acb,r=path[n(376)](path[n(388)](currManifestPath),"".concat(t,".json"));return fs[n(303)](r)?{value:!0}:{value:!1,reason:function(r,a){var e=n;return e(384).concat(r,"' ")+"value '"[e(406)](a,"' is invalid, connot resolve '").concat(t,".json'.")}}},cardId:function(r){var t=_0x1f4acb,n=path[t(383)](path[t(388)](currManifestPath));return r!==n?{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,"' ")+"value '"[e(406)](a,e(282))[e(406)](n,"'.")}}:{value:!0}},sourceConfigs:function(r){var e=_0x1f4acb;return JSON[e(284)](r)[e(359)]>ARRAY_MAX_LENGTH?{value:!1,reason:function(r){var a=e;return"ERROR: manifest.json configuration item '"[a(406)](r,"' ")+a(335).concat(ARRAY_MAX_LENGTH,a(304))}}:{value:!0}},script:function(t){var n=_0x1f4acb;if(!t)return{value:t};var r=path[n(376)](path[n(388)](currManifestPath),""[n(406)](t,n(385)));return fs[n(303)](r)?{value:t}:{value:!1,reason:function(r,a){var e=n;return"ERROR: manifest.json configuration item '"[e(406)](r,"' ")+"value '"[e(406)](a,e(373))[e(406)](t,e(357))}}},objectCheck:function(r){var t=_0x1f4acb;return"[object Object]"===Object[t(292)][t(370)][t(377)](r)?{value:r}:{value:!1,reason:function(r,a){var e=t;return e(390)[e(406)](r,e(299)).concat(a,e(381))}}},extraConfigs:function(r){var t=_0x1f4acb;return JSON[t(284)](r).length<2048?{value:r}:{value:!1,reason:function(r,a){var e=t;return e(384)[e(406)](r,"' ")+"value must less than 2048 bytes."}}}},validatorMap={id:{checkFns:[validator.id,validator[_0x1f4acb(309)]],require:!0},ver:{checkFns:validator.integer,require:!0},minSdkVer:{checkFns:[validator[_0x1f4acb(328)],bindArgs(validator[_0x1f4acb(371)],"1")],require:!0},type:{checkFns:validator[_0x1f4acb(293)],require:!0},data:{checkFns:[validator[_0x1f4acb(401)],validator.data],require:!0},entry:{checkFns:validator[_0x1f4acb(401)],require:!0},dependencies:{checkFns:validator[_0x1f4acb(343)],require:!0},dataSourceConfigs:{checkFns:[validator[_0x1f4acb(343)],validator[_0x1f4acb(361)]],require:!1},script:{checkFns:[validator.string,validator[_0x1f4acb(372)]],require:!1},extraConfigs:{checkFns:[validator.objectCheck,validator[_0x1f4acb(389)]],require:!1}};function genDepsQcardData(r){var o=_0x1f4acb;return Array[o(310)](r)?r[o(322)](function(r,a){var e,t,n=o,i=convertToVerData(a,currManifestPath);return i[n(309)]&&i[n(308)]&&(e=i[n(309)],t=i[n(308)],i=i[n(315)],r[e]={ver:t,minPlatformVer:i,uri:a}),r},{}):{}}function logHandler(t,r){var n=_0x1f4acb;r&&0<r[n(359)]&&r[n(296)](function(r){var a=n,e=""[a(406)](r[a(398)],"\n");r[a(340)]&&(e=""[a(406)](r.reason,a(386))[a(406)](r.filePath,"\n")),(r.reason[a(341)]("ERROR")?t[a(365)]:t[a(311)])[a(319)]({message:e})})}function convertToVerData(r,a){var e=_0x1f4acb;if(!/^fastView:\/\/.+/g[e(393)](r))return recordLog(e(306).concat(r,"' is invalid ")+"(the value must be started with 'fastView://').",a),{};var t=new url[e(374)](r),n=new url[e(321)](t[e(327)]),t={cardId:t[e(402)]};return n[e(337)](e(308))&&n[e(337)](e(315))?(t[e(308)]=parseInt(n.get(e(308))),t.minPlatformVer=parseInt(n.get(e(315)))):recordLog("ERROR: Attribute 'dependencies' value '"[e(406)](r,e(288))+e(325),a),t}function checkQcardAvailability(r,a){var e=_0x1f4acb,t=a[e(308)],n=a[e(315)],a=a[e(309)];Object[e(382)](r).includes(a)&&t===r[a].ver&&n===r[a].minPlatformVer&&validDeclare[e(319)](a)}function validate(e,r){var t=_0x1f4acb,n=r[e],i=[],r=validatorMap[e];return r&&(r=void 0===(r=r[t(387)])?[]:r,(r=Array.isArray(r)?r:[r])[t(296)](function(r){var a=t,r=r(n);(r=Array[a(310)](r)?r:[r])[a(296)](function(r){r.reason&&"function"==typeof r.reason&&i.push({reason:r.reason(e,n)})})})),i}function manifestValidator(e){var t=_0x1f4acb;Object[t(382)](validatorMap)[t(296)](function(r){var a=t;validatorMap[r][a(360)]&&requireAttrMap[a(319)](r)}),requireAttrMap[t(296)](function(r){var a=t;void 0===e[r]&&recordLog(a(334)[a(406)](r,"'."),currManifestPath)}),Object.keys(e).forEach(function(r){var a=t;validate(r,e)[a(296)](function(r){recordLog(r[a(398)],currManifestPath)})})}function recordLog(r,a){errLog[_0x1f4acb(319)]({line:1,column:1,reason:r,filePath:a})}function _0xeb6d(){var r=["8zykPnj","' is invalid (the value can only be an object).","keys","basename","ERROR: manifest.json configuration item '",".js","\n @ ","checkFns","dirname","extraConfigs","ERROR: Attribute '","srcJsonPath","done","test","deps","includes","manifest.json","return","reason","enum","27zmwDOT","string","hostname","1338693BTRhOz","4174247VShOcX","name","concat","[object String]","2363205JvPZEK","' is invalid, the value must keep pace with card directory name '","ERROR: Can not find combo card ","stringify","\n - ","getFlexibleCfg"," - ","' is invalid ","map","isComboCard","[object Boolean]","prototype","type","constructor","' to enable the feature.","forEach","' is invalid (the value can only be an array).","filter","' value '","writeFileSync","PROJECT_PATH","Map","existsSync"," bytes.","227767nyzFyR","ERROR: Attribute 'dependencies' value '","getJsonData","ver","cardId","isArray","warnings"," | ","match",".json","minPlatformVer","url","6HOLOIM","manifestJson","push","please ensure minSdkVer >= '","URLSearchParams","reduce","apply","value '","(the value must be contain 'ver' and 'minPlatformVer').","data","searchParams","integer","only support below values ('","' is invalid.","children","entry","utf-8","ERROR: Manifest.json does not contain configuration item '","value must less than ","251352LtUCRp","get","comboCard","value","filePath","startsWith","' value must less than 64 bytes.","array","../common/utils","(the value must be a boolean).","Arguments","(the value must be a character string).","').","path","quickCard","qcard","src.json","11966530PaIJHw","exports","src","bind",".js'."," configuration value must be 'comboCard' or 'page'.","length","require","sourceConfigs","number","ERROR: These quick cards are not declared, please declare it in manifest.json.\n","dependencies","errors","uri","parse","Object","41240xXJJNA","toString","minSdkVer","script","' is invalid, connot resolve '","URL","next","join","call","readFileSync","(the value must be an integer)."];return(_0xeb6d=function(){return r})()}function traverse(r,a){var e=_0x1f4acb,t=2<arguments[e(359)]&&void 0!==arguments[2]?arguments[2]:[];if(!r)return[];r[e(293)]===e(351)&&(r.data&&r[e(326)][e(350)]?(n=r[e(326)][e(350)],/^fastView:\/\/.+/g.test(n)&&!t[e(395)](n)&&t[e(319)](n)):recordLog("ERROR: In combo card src.json, you must reference 'quickCard' when card type is 'qcard'.",a));var n=r[e(331)]||[];return 0<n[e(359)]&&n[e(296)](function(r){traverse(r,a,t)}),t}function _0x252e(r,a){var e=_0xeb6d();return(_0x252e=function(r,a){return e[r-=281]})(r,a)}function getSrcQcardDeps(a){var r=_0x1f4acb,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(!fs[r(303)](a))return[];var t=JSON.parse(fs.readFileSync(a,r(333)));return(Array[r(310)](t)?t:[t]).forEach(function(r){traverse(r,a,e)}),e}function srcValidator(r){var a=_0x1f4acb,e=r.id,t=r[a(332)],n=r[a(364)],i=path.join(srcPath,e,""[a(406)](t,a(314))),o=genDepsQcardData(n),c=genDepsQcardData(getSrcQcardDeps(i));Object[a(382)](c)[a(296)](function(r){checkQcardAvailability(o,Object.assign(c[r],{cardId:r}),i,e)}),overwriteManifest({manifestJson:r,deps:c,srcJsonPath:i}),overwriteSrcJson(r)}function overwriteManifest(r){var e=_0x1f4acb,a=r[e(318)],t=r[e(394)],r=r[e(391)],n=path[e(376)](buildPath,a.id,e(396));fs[e(303)](n)&&(fs.writeFileSync(n,JSON.stringify(a,null,2)),0<(n=Object[e(382)](t)[e(298)](function(r){return!validDeclare[e(395)](r)})).length&&(a=n[e(289)](function(r){var a=e;return t[r][a(366)]})[e(376)](e(285)),recordLog(e(363)+e(287)[e(406)](a),r)))}function overwriteSrcJson(r){var a,e,t=_0x1f4acb,n=r.id,r=r.script,n=path[t(376)](buildPath,n),r=path[t(376)](n,""[t(406)](r,".js"));fs[t(303)](r)&&(n=path[t(376)](n,t(352)),a=fs.readFileSync(r,"utf-8"),(e=getJsonData(n))[t(372)]=a,fs[t(300)](n,JSON.stringify(e,null,4)),fs.unlinkSync(r))}function combocardJsonValidate(r){var t=_0x1f4acb;errLog=[];var a=utils[t(286)]()[t(338)],a=void 0===a?[]:a;0<a[t(359)]&&(a[t(296)](function(r){var a=t,e=(validDeclare=[],path[a(376)](srcPath,r,a(396)));fs[a(303)](e)?(currManifestPath=e,manifestValidator(e=JSON[a(367)](fs[a(378)](e,"utf-8"))),srcValidator(e)):recordLog(a(283).concat(r,"."))}),logHandler(r,errLog))}module[_0x1f4acb(354)]=combocardJsonValidate;